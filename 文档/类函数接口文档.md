# 类函数接口文档

*基于Django的家政服务平台项目API开发文档*

---

## 用户类(User)接口

---

### 登录检测

**函数名**:`login_check` **方法**:`静态方法`  **脚本路径**：`account/models.py`

**描述**

> 检测是否为已登录状态，当未登录时进入需要登录态页面时跳转至登录页面

**输入参数**

| 参数名    | 必选 | 类型      | 说明       |
| --------- | ---- | --------- | ---------- |
| `request` | 是   | `Request` | 提交的请求 |

### 登录功能

**函数名**:`login`  **方法**:`静态方法` **脚本路径**：`account/models.py`

**描述**

> 将账户登录并将登录信息存入session，返回登录的消息

**输入参数**

| 参数名    | 必选 | 类型      | 说明       |
| --------- | ---- | --------- | ---------- |
| `request` | 是   | `Request` | 提交的请求 |

**返回参数**

| 参数名 | 必须 | 类型           | 说明       |
| ------ | ---- | -------------- | ---------- |
|        | 是   | `HttpResponse` | 返回的响应 |

---

### 修改用户名

**函数名**:`change_username` **方法**:`成员方法`  **脚本路径**：`account/models.py`

**描述**

> 将用户名修改并保存、session内容更新

**输入参数**

| 参数名         | 必选 | 类型      | 说明       |
| -------------- | ---- | --------- | ---------- |
| `request`      | 是   | `Request` | 提交的请求 |
| `new_username` | 是   | `string`  | 新的用户名 |

### 修改密码

**函数名**:`change_password` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 修改用户密码，加密并存入数据库

**输入参数**

| 参数名         | 必选 | 类型     | 说明     |
| -------------- | ---- | -------- | -------- |
| `new_password` | 是   | `string` | 新的密码 |



---

### 获取用户所有订单

**函数名**:`get_all_orders` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取返回该用户的所有订单

**返回参数**

| 参数名   | 类型         | 说明                 |
| -------- | ------------ | -------------------- |
| `orders` | `Order List` | 该用户的所有订单列表 |

---

### 获取用户购物车

**函数名**:`get_cart` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取返回该用户的购物车

**返回参数**

| 参数名  | 类型        | 说明                       |
| ------- | ----------- | -------------------------- |
| `carts` | `Cart List` | 该用户所有购物车的信息列表 |

---

### 头像上传

---

**函数名**:`upload_portrait_img` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 上传用户头像，返回是否上传成功

**输入参数**

| 参数名    | 必选 | 类型      | 说明       |
| --------- | ---- | --------- | ---------- |
| `request` | 是   | `Request` | 提交的请求 |

**返回参数**

| 参数名    | 类型      | 说明         |
| --------- | --------- | ------------ |
| `success` | `boolean` | 是否上传成功 |

### 获取用户地址

---

**函数名**:`transform_address` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 将数据库存入的省份、市区、县 的代号映射转换为字符串

**返回参数**

| 参数名       | 类型     | 说明 |
| ------------ | -------- | ---- |
| `str_prov`   | `string` | 省份 |
| `str_city`   | `string` | 市区 |
| `str_county` | `string` | 县   |

---

## 购物车(Cart)类

### 获取购物车中某一服务的时长

**函数名**:`get_cart_hour` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 返回购物车中某一服务的时长

**返回参数**

| 参数名        | 类型     | 说明                   |
| ------------- | -------- | ---------------------- |
| `delta_hours` | `double` | 购物车中某一服务的时长 |



### 获取购物车的总价格

**函数名**:`get_cart_price` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 返回购物车中总价格

**返回参数**

| 参数名       | 类型     | 说明           |
| ------------ | -------- | -------------- |
| `total_cost` | `double` | 购物车中总价格 |

## 订单类(Order)接口

---

### 设置订单评价

**函数名**:`get_cart_price` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 设置订单的评价和星级

**输入参数**

| 参数名    | 必选 | 类型     | 说明       |
| --------- | ---- | -------- | ---------- |
| `comment` | 是   | `string` | 评论内容   |
| `star`    | 是   | `int`    | 评价星级数 |

**返回参数**

| 参数名 | 类型     | 说明             |
| ------ | -------- | ---------------- |
| `msg`  | `string` | 评价请求响应信息 |

### 获取订单的价格

**函数名**:`get_order_price` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取订单的价格

**输入参数**

| 参数名    | 必选 | 类型     | 说明       |
| --------- | ---- | -------- | ---------- |
| `comment` | 是   | `string` | 评论内容   |
| `star`    | 是   | `int`    | 评价星级数 |

**返回参数**

| 参数名        | 类型  | 说明     |
| ------------- | ----- | -------- |
| `order_price` | `int` | 订单价格 |

### 支付订单

**函数名**:`pay_order` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 将订单设为支付状态，并将对应服务销量加1

**输入参数**

| 参数名    | 必选 | 类型     | 说明       |
| --------- | ---- | -------- | ---------- |
| `comment` | 是   | `string` | 评论内容   |
| `star`    | 是   | `int`    | 评价星级数 |

**返回参数**

| 参数名        | 类型  | 说明     |
| ------------- | ----- | -------- |
| `order_price` | `int` | 订单价格 |

### 订单号生成器

**函数名**:`order_no_generator` **方法**:`静态方法` **脚本路径**：`account/models.py`

**描述**

> 生成与时间相关的字符串序列作为订单号

**返回参数**

| 参数名     | 类型     | 说明       |
| ---------- | -------- | ---------- |
| `order_no` | `string` | 订单序列号 |

### 获取订单号

**函数名**:`get_orders_by_order_no` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取该订单的订单号

**返回参数**

| 参数名     | 类型     | 说明       |
| ---------- | -------- | ---------- |
| `order_no` | `string` | 订单序列号 |

### 获取同订单号的订单

**函数名**:`get_orders_by_order_no` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取在同一购物车下购买的所有商品的订单

**返回参数**

| 参数名   | 类型         | 说明         |
| -------- | ------------ | ------------ |
| `orders` | `Order List` | 订单对象列表 |

## 店铺类(Shop)接口

### 获取近几个月订单销售数据

**函数名**:`get_recent_month_orders_data` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺近几个月每个月的订单数量

**返回参数**

| 参数名              | 类型   | 说明     |
| ------------------- | ------ | -------- |
| `recent_month_data` | `dict` | 数据信息 |

### 获取当月的详细订单数据

**函数名**:`get_current_month_orders_data` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺当月每个服务种类的订单数量

**返回参数**

| 参数名         | 类型   | 说明     |
| -------------- | ------ | -------- |
| `data_by_type` | `dict` | 数据信息 |

### 获取店铺全部订单

**函数名**:`get_total_orders` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺各服务的订单

**返回参数**

| 参数名        | 类型         | 说明     |
| ------------- | ------------ | -------- |
| `shop_orders` | `Order List` | 订单列表 |

### 获取店铺提供的所有服务

**函数名**:`get_shop_services` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺提供的所有服务

**返回参数**

| 参数名          | 类型           | 说明     |
| --------------- | -------------- | -------- |
| `shop_services` | `Service List` | 服务列表 |

### 获取店铺星级

**函数名**:`get_shop_star` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺所有服务的平均星级

**返回参数**

| 参数名      | 类型     | 说明     |
| ----------- | -------- | -------- |
| `aver_star` | `doubel` | 平均星级 |

### 获取店铺店主的电话号码

**函数名**:`get_shop_phonenumber` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取店铺所有服务的平均星级

**返回参数**

| 参数名      | 类型  | 说明               |
| ----------- | ----- | ------------------ |
| `phone_num` | `int` | 联系店主的电话号码 |

## 服务类(Service)接口

### 获取服务图片路径

**函数名**:` get_img_path` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取服务图片相对项目根目录的路径

**返回参数**

| 参数名 | 类型     | 说明                 |
| ------ | -------- | -------------------- |
| `path` | `string` | 相对项目根目录的路径 |

### 获取服务的全部订单

**函数名**:` get_img_path` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 获取服务图片相对项目根目录的路径

**返回参数**

| 参数名 | 类型     | 说明                 |
| ------ | -------- | -------------------- |
| `path` | `string` | 相对项目根目录的路径 |

### 新建服务

**函数名**:` new_service` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 新建一个服务

**返回参数**

| 参数名    | 类型      | 说明           |
| --------- | --------- | -------------- |
| `service` | `Service` | 返回新建的服务 |

### 获取服务的星级

**函数名**:` get_service_star` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 通过订单平均评价获取服务的星级

**返回参数**

| 参数名      | 类型     | 说明     |
| ----------- | -------- | -------- |
| `aver_star` | `double` | 平均星级 |



### 上传服务的图片

**函数名**:`upload_service_img` **方法**:`成员方法` **脚本路径**：`account/models.py`

**描述**

> 上传服务图片，返回是否上传成功

**输入参数**

| 参数名    | 必选 | 类型      | 说明       |
| --------- | ---- | --------- | ---------- |
| `request` | 是   | `Request` | 提交的请求 |

**返回参数**

| 参数名    | 类型      | 说明         |
| --------- | --------- | ------------ |
| `success` | `boolean` | 是否上传成功 |

## 工具类(Util)接口

---

### 推荐算法

**描述**

> 分析用户行为并返回推荐的服务

**输入参数**

| 参数名    | 必选 | 类型      | 说明               |
| --------- | ---- | --------- | ------------------ |
| `service` | `是` | `Service` | 用户购买的服务对象 |
| `count`   | `是` | `int`     | 推荐的服务个数     |

**返回参数**

| 参数名     | 类型        | 说明                 |
| ---------- | ----------- | -------------------- |
| `services` | `Service[]` | 推荐给用户的服务顺序 |

**说明/示例**